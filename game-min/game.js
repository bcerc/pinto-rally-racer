/*! Boxcar Racer - v - 2014-08-28
* Copyright (c) 2014 ; Licensed  */
Element.prototype.on=Element.prototype.addEventListener,window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame,window.Matrix=window.WebKitCSSMatrix||window.MSCSSMatrix||window.CSSMatrix;var game=function(){function a(){o=new c,p=new d,q=new e(o),p.add(o,"children"),r.appendChild(p.el),window.player=o,window.level=p}function b(){q.update(),o.update().render(),p.update().render()}function c(){return f(this,"boxcar"),h(this),k(this),j(this),l(this),i(this),this.width=50,this.height=50,this.pos.y=260,this.pos.z=1,this.accel=.5,this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",this.update=function(){var a="50% 50%";return this.vel&&(this.pos.x+=this.vel.x,this.vel.x=this.vel.x*this.friction,this.rotation.y=4*this.vel.x,this.rotation.z=6*-this.vel.x,this.rotation.y>1?a="100% 50%":this.rotation.y<-1&&(a="0% 50%"),this.el.style.transformOrigin=a),this},this}function d(){return f(this,"level"),g(this,"children"),h(this),k(this),l(this),this.width=700,this.height=29e3,this.rotation.x=-15,this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",this}function e(a){function b(a){var b={37:d,39:e,65:d,68:e};b[a.keyCode]&&b[a.keyCode]()}function c(a){var b={37:f,39:g,65:f,68:g};b[a.keyCode]&&b[a.keyCode]()}function d(){k=!0}function e(){j=!0}function f(){k=!1}function g(){j=!1}var h=document.body,i=a,j=!1,k=!1;return h.on("keydown",b),h.on("keyup",c),{isLeft:k,isRight:j,update:function(){k&&(i.vel.x+=i.accel),j&&(i.vel.x-=i.accel)}}}function f(a,b){a.el=document.createElement("div"),a.el.classList.add(b),a.el.appendChild(s[b].content.cloneNode(!0))}function g(a,b){a.collections||(a.collections={}),a.collections[b]=[],a.add=function(b,c){try{a.collections[c].push(b),b.render&&a.el.appendChild(b.el)}catch(d){throw new Error("Cannot add 'undefined' to collection to "+c)}return a},a.remove=function(b,c){n("remove");var d;for(var e in a.collections[c])n(a.collections[c][e],b),d=a.collections[c][e],d==b&&(d.render&&d.el.parentNode.removeChild(d.el),a.collections[c]=a.collections[c].splice(1,e))}}function h(a){a.pos={x:0,y:0,z:0},a.moveTo=function(b,c,d){return a.pos.x=b||a.pos.x,a.pos.y=c||a.pos.y,a.pos.z=d||a.pos.z,a}}function i(a,b,c){a.minVel=b||-250,a.maxVel=c||250,a.friction=.9,a.vel={x:0,y:0,z:0},a.setVelocity=function(b,c,d){return a.vel.x=b||a.pos.x,a.vel.y=c||a.pos.y,a.vel.z=d||a.pos.z,a}}function j(a){a.scale={x:1,y:1,z:1},a.scaleTo=function(b,c,d){return a.scale.x=b||a.scale.x,a.scale.y=c||a.scale.y,a.scale.z=d||a.scale.z,a}}function k(a){a.rotation={x:0,y:0,z:0},a.rotateTo=function(b,c,d){return a.rotation.x=b||a.rotation.x,a.rotation.y=c||a.rotation.y,a.rotation.z=d||a.rotation.z,a}}function l(a){a.update=function(){return a.vel&&(a.pos.x+=a.vel.x,a.vel.x=a.vel.x*a.friction),a},a.render=function(){var b={x:a.scale?a.scale.x:1,y:a.scale?a.scale.y:1,z:a.scale?a.scale.z:1},c={x:a.pos.x,y:a.pos.y,z:a.pos.z},d={x:a.rotation.x,y:a.rotation.y,z:a.rotation.z};return a.el.style.transform="translateX("+c.x+"px) translateY("+c.y+"px) translateZ("+c.z+"px) scaleX("+b.x+") scaleY("+b.y+") scaleZ("+b.z+") rotateX("+d.x+"deg) rotateZ("+d.z+"deg) rotateY("+d.y+"deg) ",a}}function m(){return(new Date).getTime()}function n(){var a=Array.prototype.slice.call(arguments);console.log.apply(console,a)}var o,p,q,r=(document.querySelector("#game-canvas"),document.querySelector("#game-scene")),s={boxcar:document.querySelector("#boxcar-template"),level:document.querySelector("#level-template")},t=null;return{start:function(){n("game:start"),t=m(),a(),this.step()},stop:function(){n("game:stop"),cancelAnimationFrame(this.requestId),_stopTime=m()},step:function(a){var c;null===t&&(t=a),c=a-t,this.requestId=requestAnimationFrame(this.step.bind(this)),b()}}}();